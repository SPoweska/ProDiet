@*@page "/createproduct"*@
@using Microsoft.AspNetCore.Identity
@using Microsoft.AspNetCore.Razor.Language.Intermediate
@using ProDiet.Data.Enums
@using ProDiet.Services
@using System.ComponentModel.DataAnnotations;
@using Microsoft.IdentityModel.Tokens
@using ProDiet.Data.Models
@inject NavigationManager navigationManager;
@inject UserManager<IdentityUser> userManager;
@inject IProductStoresService iProductStoresService;
@inject IHttpContextAccessor httpContextAccessor;


<MudDialog>
    <DialogContent>
        <EditForm Model="_product" OnValidSubmit="OnValidSubmit">
            <DataAnnotationsValidator/>
            <ValidationSummary/>
            <MudCard>
                <MudCardContent>
                    <MudTextField @bind-Value="_product.ProductName"
                                  For="@(() => _product.ProductName)"
                                  Immediate="true"
                                  Label="Nazwa produktu"/>
                    <MudTextField @bind-Value="_product.Carbohydrates"
                                  For="@(() => _product.Carbohydrates)"
                                  Immediate="true"
                                  Label="Węglowodany"/>
                    <MudTextField @bind-Value="_product.Fats"
                                  For="@(() => _product.Fats)"
                                  Immediate="true"
                                  Label="Tłuszcz"/>
                    <MudTextField @bind-Value="_product.Proteins"
                                  For="@(() => _product.Proteins)"
                                  Immediate="true"
                                  Label="Białko"/>
                    <MudTextField @bind-Value="_product.Fiber"
                                  For="@(() => _product.Fiber)"
                                  Immediate="true"
                                  Label="Błonnik"/>
                    <MudTextField @bind-Value="_product.Calories"
                                  For="@(() => _product.Calories)"
                                  Immediate="true"
                                  Label="Kalorie"/>
                    <MudSelect T="string" Label="Alergeny" MultiSelection="true"  @bind-SelectedValues="selectedAlergens">
                        @foreach (var alergen in Alergenes)
                        {
                            <MudSelectItem T="string" Value="@(alergen)">@alergen</MudSelectItem>
                        }
                    </MudSelect>
                    <MudRadioGroup @bind-SelectedOption="_product.ProductCategory"
                                   For="() => _product.ProductCategory">
                        <MudRadio Placement="Placement.Top" Option="@("Nabiał")">Nabiał
                            <MudCard >
                                <MudImage Width="50" Height="50" Src="Icons/ProductCategories/milk.png"></MudImage>
                            </MudCard>
                        </MudRadio>
                        <MudRadio Placement="Placement.Top" Option="@("Zbożowe")">Zbożowe
                            <MudCard >
                                <MudImage Width="50" Height="50" Src="Icons/ProductCategories/wheat.png"></MudImage>
                            </MudCard>
                        </MudRadio>
                        <MudRadio Placement="Placement.Top" Option="@("Strączkowe")">Strączkowe
                            <MudCard >
                                <MudImage Width="50" Height="50" Src="Icons/ProductCategories/beans.png"></MudImage>
                            </MudCard>
                        </MudRadio>
                        <MudRadio Placement="Placement.Top" Option="@("Warzywa")">Warzywa
                            <MudCard >
                                <MudImage Width="50" Height="50" Src="Icons/ProductCategories/vegetable.png"></MudImage>
                            </MudCard>
                        </MudRadio>
                        <MudRadio Placement="Placement.Top" Option="@("Owoce")">Owoce
                            <MudCard >
                                <MudImage Width="50" Height="50" Src="Icons/ProductCategories/fruit.png"></MudImage>
                            </MudCard>
                        </MudRadio>
                        <MudRadio Placement="Placement.Top" Option="@("Mięso")">Mięso
                            <MudCard >
                                <MudImage Width="50" Height="50" Src="Icons/ProductCategories/meat.png"></MudImage>
                            </MudCard>
                        </MudRadio>
                        <MudRadio Placement="Placement.Top" Option="@("Ryby")">Ryby
                            <MudCard >
                                <MudImage Width="50" Height="50" Src="Icons/ProductCategories/fish.png"></MudImage>
                            </MudCard>
                        </MudRadio>
                        <MudRadio Placement="Placement.Top" Option="@("Owoce morza")">Owoce morza
                            <MudCard >
                                <MudImage Width="50" Height="50" Src="Icons/ProductCategories/seafood.png"></MudImage>
                            </MudCard>
                        </MudRadio>
                        <MudRadio Placement="Placement.Top" Option="@("Zioła i przyprawy")">Zioła i przyprawy
                            <MudCard >
                                <MudImage Width="50" Height="50" Src="Icons/ProductCategories/herb.png"></MudImage>
                            </MudCard>
                        </MudRadio>
                        <MudRadio Placement="Placement.Top" Option="@("Orzechy")">Orzechy
                            <MudCard >
                                <MudImage Width="50" Height="50" Src="Icons/ProductCategories/peanut.png"></MudImage>
                            </MudCard>
                        </MudRadio>
                        <MudRadio Placement="Placement.Top" Option="@("Nasiona")">Nasiona
                            <MudCard >
                                <MudImage Width="50" Height="50" Src="Icons/ProductCategories/seeds.png"></MudImage>
                            </MudCard>
                        </MudRadio>
                        <MudRadio Placement="Placement.Top" Option="@("Grzyby")">Grzyby
                            <MudCard >
                                <MudImage Width="50" Height="50" Src="Icons/ProductCategories/fungi.png"></MudImage>
                            </MudCard>
                        </MudRadio>
                        <MudRadio Placement="Placement.Top" Option="@("Napoje")">Napoje
                            <MudCard >
                                <MudImage Width="50" Height="50" Src="Icons/ProductCategories/drink.png"></MudImage>
                            </MudCard>
                        </MudRadio>
                        <MudRadio Placement="Placement.Top" Option="@("Słodycze")">Słodycze
                            <MudCard >
                                <MudImage Width="50" Height="50" Src="Icons/ProductCategories/candy.png"></MudImage>
                            </MudCard>
                        </MudRadio>
                        <MudRadio Placement="Placement.Top" Option="@("Suplementy i probiotyki")">Suplementy i probiotyki
                            <MudCard>
                                <MudImage Width="50" Height="50" Src="Icons/ProductCategories/drug.png"></MudImage>
                            </MudCard>
                        </MudRadio>
                        <MudRadio Placement="Placement.Top" Option="@("Inne")">Inne
                            <MudCard>
                                <MudImage Width="50" Height="50" Src="Icons/ProductCategories/others.png"></MudImage>
                            </MudCard>
                        </MudRadio>
                    </MudRadioGroup>
                </MudCardContent>
            </MudCard>
            @*<MudCardActions>
                <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="demo-form-button">Dodaj</MudButton>
            </MudCardActions>*@
            <DialogActions>
                <MudButton OnClick="Cancel">Cancel</MudButton>
                <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="demo-form-button">Dodaj</MudButton>
            </DialogActions>
        </EditForm>

    </DialogContent>
    

</MudDialog>


@code {

    private ProDiet.Models.Product _product;

    [CascadingParameter]
    MudDialogInstance mudDialog { get; set; }


    public ICollection<string> selectedAlergens { get; set; }

    private string[] Alergenes =
    {
        "Gluten",
        "Laktoza",
        "Celiakia",
        "Kofeina",
        "Alkohol",
        "Histamina"
    };




    void Submit() => mudDialog.Close(DialogResult.Ok(true));
    void Cancel() => mudDialog.Cancel();




    protected override async Task OnInitializedAsync()
    {
        _product = new ProDiet.Models.Product();
        await base.OnInitializedAsync();
    }


    private void OnValidSubmit()
    {


        var user = httpContextAccessor.HttpContext.User;
        var id = userManager.GetUserId(user);
        _product.CreatedBy = id;
        _product.CreatedAt = DateTime.Now;
        iProductStoresService.AddProduct(_product);
        Thread.Sleep(500);
        Submit();


    }

}
